# ç‰ˆæœ¬æ ¼å¼æ›´æ–°æ€»ç»“

## ğŸ“‹ æ¦‚è¿°

å°†ç‰ˆæœ¬æ ¼å¼ä» `v0.1.0-git508c2eb-build22777` æ›´æ–°ä¸º `0.1.0.508c2eb (built at 2026-01-20T03:44:43+00:00)`

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

### 1. **install.sh** - å®‰è£…è„šæœ¬

#### ç‰ˆæœ¬æå–å‡½æ•° (`get_installed_version`)
- **æ—§æ ¼å¼**: `v0.1.0-git508c2eb-build22777`
- **æ–°æ ¼å¼**: `0.1.0.508c2eb (built at 2026-01-20T03:44:43Z)`
- **æ­£åˆ™è¡¨è¾¾å¼**: `[0-9]+\.[0-9]+\.[0-9]+\.[0-9a-zA-Z]+`
- **æå–ç»“æœ**: `0.1.0.508c2eb`

#### ç‰ˆæœ¬æ¯”è¾ƒå‡½æ•° (`version_lt`)
- **æ ¼å¼è§£æ**: `0.1.0.508c2eb` â†’ base=`0.1.0`, hash=`508c2eb`
- **æ¯”è¾ƒä¼˜å…ˆçº§**:
  1. åŸºç¡€ç‰ˆæœ¬å· (0.1.0 vs 0.2.0)
  2. Git å“ˆå¸Œå€¼ (508c2eb vs abc1234) - å­—å…¸åº
- **å…¼å®¹æ€§**: æ”¯æŒå¸¦ `v` å‰ç¼€çš„ç‰ˆæœ¬å·

### 2. **Makefile** - æ„å»ºé…ç½®

#### æ–°å¢å˜é‡
```makefile
BUILD_TIME ?= $(shell date -u '+%Y-%m-%dT%H:%M:%SZ')
HASH ?= $(shell git rev-parse --short HEAD 2>/dev/null || echo "unknown")
LDFLAGS = -X main.Version=$(VERSION) -X main.Hash=$(HASH) -X main.BuildTime=$(BUILD_TIME)
```

#### ç¼–è¯‘å‚æ•°
- **Version**: ä» `cmd/nexa/main.go` è¯»å–
- **Hash**: Git æäº¤çŸ­å“ˆå¸Œ
- **BuildTime**: UTC æ—¶é—´æˆ³

### 3. **.gitlab-ci.yml** - CI é…ç½®

#### Build Stage
```yaml
VERSION=$VERSION HASH=$COMMIT_HASH BUILD_TIME=$BUILD_TIME make all
```

#### Release Stage
- **ç‰ˆæœ¬æ ¼å¼**: `${VERSION}.${COMMIT_HASH}` (ä¾‹å¦‚: `0.1.0.508c2eb`)
- **Tag æ ¼å¼**: ä¸å¸¦ `v` å‰ç¼€ï¼Œç›´æ¥ä½¿ç”¨å®Œæ•´ç‰ˆæœ¬å·
- **ç¤ºä¾‹**: `0.1.0.508c2eb`

### 4. **cmd/nexa/main.go** - ç‰ˆæœ¬è¾“å‡º

#### ç‰ˆæœ¬å˜é‡
```go
var (
    Version   = "0.1.0"
    BuildTime = ""
    Hash      = ""
)

func getVersion() string {
    return fmt.Sprintf("%s.%s (built at %s)", Version, Hash, BuildTime)
}
```

#### è¾“å‡ºæ ¼å¼
```
nexa version 0.1.0.508c2eb (built at 2026-01-20T03:44:43Z)
```

## ğŸ§ª æµ‹è¯•ç»“æœ

### ç‰ˆæœ¬æå–æµ‹è¯•
| è¾“å…¥ | æå–ç»“æœ | çŠ¶æ€ |
|------|---------|------|
| `nexa version 0.1.0.508c2eb (built at 2026-01-20T03:44:43Z)` | `0.1.0.508c2eb` | âœ… |
| `0.1.0.test123 (built at ...)` | `0.1.0.test123` | âœ… |
| `nexa 0.2.0.abc1234 (built at ...)` | `0.2.0.abc1234` | âœ… |

### ç‰ˆæœ¬æ¯”è¾ƒæµ‹è¯•
| v1 | v2 | ç»“æœ | çŠ¶æ€ |
|----|----|----|------|
| `0.1.0.508c2eb` | `0.1.0.508c2ec` | v1 < v2 | âœ… |
| `0.1.0.508c2ec` | `0.1.0.508c2eb` | v1 >= v2 | âœ… |
| `0.1.0.508c2eb` | `0.1.0.508c2eb` | v1 >= v2 | âœ… |
| `0.1.0.508c2eb` | `0.2.0.abc1234` | v1 < v2 | âœ… |
| `0.2.0.abc1234` | `0.1.0.508c2eb` | v1 >= v2 | âœ… |
| `0.1.0.508c2eb` | `0.1.1.abc1234` | v1 < v2 | âœ… |
| `v0.1.0.508c2eb` | `v0.1.0.508c2ec` | v1 < v2 | âœ… (å…¼å®¹ v å‰ç¼€) |
| `0.1.0` | `0.1.0.508c2eb` | v1 >= v2 | âœ… |

**æµ‹è¯•é€šè¿‡ç‡**: 10/10 (100%)

## ğŸ”„ ç‰ˆæœ¬æ ¼å¼å¯¹æ¯”

### æ—§æ ¼å¼
```
æ ¼å¼: v{major}.{minor}.{patch}-git{hash}-build{job_id}
ç¤ºä¾‹: v0.1.0-git508c2eb-build22777
è¾“å‡º: nexa version nexa has version v0.1.0-git508c2eb-build22777
```

### æ–°æ ¼å¼
```
æ ¼å¼: {major}.{minor}.{patch}.{hash}
ç¤ºä¾‹: 0.1.0.508c2eb
è¾“å‡º: nexa version 0.1.0.508c2eb (built at 2026-01-20T03:44:43Z)
```

## ğŸ“¦ ç‰ˆæœ¬ç»„æˆéƒ¨åˆ†

| éƒ¨åˆ† | è¯´æ˜ | æ¥æº | ç¤ºä¾‹ |
|------|------|------|------|
| **Major** | ä¸»ç‰ˆæœ¬å· | `cmd/nexa/main.go` | `0` |
| **Minor** | æ¬¡ç‰ˆæœ¬å· | `cmd/nexa/main.go` | `1` |
| **Patch** | ä¿®è®¢ç‰ˆæœ¬å· | `cmd/nexa/main.go` | `0` |
| **Hash** | Git æäº¤çŸ­å“ˆå¸Œ | `git rev-parse --short HEAD` | `508c2eb` |
| **BuildTime** | æ„å»ºæ—¶é—´æˆ³ | `date -u '+%Y-%m-%dT%H:%M:%SZ'` | `2026-01-20T03:44:43Z` |

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æœ¬åœ°æ„å»º
```bash
# ä½¿ç”¨é»˜è®¤å‚æ•°ï¼ˆè‡ªåŠ¨è·å– HASH å’Œ BUILD_TIMEï¼‰
make all

# æŒ‡å®šç‰ˆæœ¬å·
VERSION=0.1.0 make all

# å®Œå…¨è‡ªå®šä¹‰
VERSION=0.1.0 HASH=abc1234 BUILD_TIME=2026-01-20T10:00:00Z make all
```

### æŸ¥çœ‹ç‰ˆæœ¬
```bash
nexa --version
# è¾“å‡º: nexa version 0.1.0.508c2eb (built at 2026-01-20T03:44:43Z)
```

### å®‰è£…/æ›´æ–°
```bash
# ä» GitHub è‡ªåŠ¨å®‰è£…æˆ–æ›´æ–°
curl -fsSL https://raw.githubusercontent.com/nexisproject/nexa/master/install.sh | bash
```

## ğŸ”§ CI/CD å·¥ä½œæµç¨‹

### GitLab CI Pipeline

```
1ï¸âƒ£ Sync Stage (æ¯æ¬¡ master æ¨é€)
   â””â”€ åŒæ­¥ä»£ç åˆ° GitHub

2ï¸âƒ£ Build Stage (æ¯æ¬¡ master æ¨é€)
   â”œâ”€ æå–ç‰ˆæœ¬å·: 0.1.0
   â”œâ”€ è·å– Git Hash: 508c2eb
   â”œâ”€ è·å–æ„å»ºæ—¶é—´: 2026-01-20T03:44:43Z
   â””â”€ ç¼–è¯‘å¤šå¹³å°äºŒè¿›åˆ¶
      â”œâ”€ Linux (amd64, arm64)
      â”œâ”€ macOS (amd64, arm64)
      â””â”€ Windows (amd64)

3ï¸âƒ£ Release Stage (ä»…åœ¨ cmd/nexa å˜æ›´æ—¶)
   â”œâ”€ åˆ›å»ºæ ‡ç­¾: 0.1.0.508c2eb
   â”œâ”€ æ¨é€åˆ° GitHub
   â”œâ”€ åˆ›å»º GitHub Release
   â””â”€ ä¸Šä¼ ç¼–è¯‘äº§ç‰©
```

## ğŸ“ æ³¨æ„äº‹é¡¹

### GitHub åŒæ­¥é—®é¢˜è§£å†³
- **é—®é¢˜**: GitLab å’Œ GitHub çš„ commit hash ä¸ä¸€è‡´
- **åŸå› **: åœ¨æ¨é€åˆ° GitHub å‰è·å–çš„ hash æ˜¯ GitLab çš„
- **è§£å†³**: 
  1. Sync stage åœ¨ build ä¹‹å‰æ‰§è¡Œï¼Œç¡®ä¿ä»£ç å…ˆåŒæ­¥
  2. Hash åœ¨ build é˜¶æ®µè·å–ï¼Œæ­¤æ—¶ä»£ç å·²åŒæ­¥åˆ° GitHub
  3. ä½¿ç”¨ç›¸åŒçš„ commit hash æ„å»ºå’Œåˆ›å»º release

### Tag å‘½å
- **ä¸ä½¿ç”¨ `v` å‰ç¼€**: æ–°æ ¼å¼ç›´æ¥ä½¿ç”¨ `0.1.0.508c2eb`
- **å…¼å®¹æ€§**: install.sh ä»ç„¶æ”¯æŒå¸¦ `v` å‰ç¼€çš„ç‰ˆæœ¬å·
- **GitHub Release**: Tag åç§°å³ä¸ºå®Œæ•´ç‰ˆæœ¬å·

### ç‰ˆæœ¬æ¯”è¾ƒé€»è¾‘
- **åŸºç¡€ç‰ˆæœ¬ä¼˜å…ˆ**: `0.1.0` vs `0.2.0` ç›´æ¥æ¯”è¾ƒ
- **Hash æ¬¡è¦**: ä»…åœ¨åŸºç¡€ç‰ˆæœ¬ç›¸åŒæ—¶æ¯”è¾ƒ
- **å­—å…¸åº**: Git hash æŒ‰å­—å…¸åºæ¯”è¾ƒ

## ğŸ¯ ä¼˜åŠ¿

1. âœ… **æ›´ç®€æ´**: å»é™¤äº†å†—ä½™çš„ `-git` å’Œ `-build` å‰ç¼€
2. âœ… **æ›´æ ‡å‡†**: ç¬¦åˆè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ + Git hash
3. âœ… **æ›´æ¸…æ™°**: æ„å»ºæ—¶é—´ç‹¬ç«‹æ˜¾ç¤ºï¼Œä¸å½±å“ç‰ˆæœ¬å·
4. âœ… **æ˜“äºè§£æ**: æ­£åˆ™è¡¨è¾¾å¼æ›´ç®€å•
5. âœ… **å‘åå…¼å®¹**: æ”¯æŒæ—§ç‰ˆæœ¬å·æ ¼å¼

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `install.sh` - å®‰è£…è„šæœ¬
- `Makefile` - æ„å»ºé…ç½®
- `.gitlab-ci.yml` - CI é…ç½®
- `cmd/nexa/main.go` - ç‰ˆæœ¬å®šä¹‰
- `docs/gitlab-ci-setup.md` - CI é…ç½®æ–‡æ¡£

---

**æ›´æ–°æ—¥æœŸ**: 2026-01-20
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡
