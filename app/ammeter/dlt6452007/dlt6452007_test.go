// Copyright (C) micros. 2024-present.
//
// Created at 2024-12-11, by liasica

package dlt6452007

import (
	"testing"

	"github.com/stretchr/testify/require"

	"orba.plus/nexa/pkg/dump"
)

func TestParse(t *testing.T) {
	// data := []byte{0xFE, 0xFE, 0xFE, 0xFE, 0x68, 0x72, 0x32, 0x09, 0x19, 0x04, 0x22, 0x68, 0x91, 0x08, 0x33, 0x33, 0x34, 0x33, 0x33, 0x33, 0x33, 0x33, 0xEE, 0x16, 0x32, 0xE2, 0x20}
	// data := []byte{0xFE, 0xFE, 0xFE, 0xFE, 0x68, 0x72, 0x32, 0x09, 0x19, 0x04, 0x22, 0x68, 0x91, 0x08, 0x33, 0x33, 0x34, 0x33, 0x33, 0x33, 0x33, 0x33, 0xEE, 0x16}
	// data := []byte{0xfe, 0xfe, 0xfe, 0xfe, 0x68, 0x34, 0x18, 0x4, 0x24, 0x6, 0x24, 0x68, 0x91, 0x8, 0x33, 0x33, 0x33, 0x33, 0x44, 0x33, 0x33, 0x33, 0xb0, 0x16}
	// data := []byte{0xfe, 0xfe, 0xfe, 0xfe, 0x68, 0x34, 0x18, 0x4, 0x24, 0x6, 0x24, 0x68, 0xd1, 0x1, 0x35, 0x75, 0x16}
	data := []byte{0xFE, 0xFE, 0xFE, 0xFE, 0x68, 0x34, 0x18, 0x04, 0x24, 0x06, 0x24, 0x68, 0x91, 0x10, 0x33, 0x32, 0x36, 0x35, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x43, 0x16}
	t.Logf("%X", data)
	t.Log(dump.Bytes(data))

	// data := []byte{0xfe, 0xfe, 0xfe, 0xfe, 0x68, 0x72, 0x32, 0x9, 0x19, 0x4, 0x22, 0x68, 0x91, 0x6, 0x36, 0x38, 0x33, 0x37, 0x33, 0x33, 0x91, 0x16}
	// data := []byte{0xfe, 0xfe, 0xfe, 0xfe, 0x68, 0x77, 0x32, 0x9, 0x19, 0x4, 0x22, 0x68, 0x91, 0x1a, 0x34, 0x37, 0x33, 0x37, 0xaa, 0x65, 0x3c, 0x4c, 0x37, 0x55, 0x65, 0x63, 0x65, 0x65, 0x63, 0x68, 0x63, 0x67, 0x92, 0xa9, 0x9a, 0x6c, 0x6b, 0x64, 0x64, 0x33, 0x32, 0x16}
	// data := []byte{0xFE, 0xFE, 0xFE, 0xFE, 0x68, 0x72, 0x32, 0x09, 0x19, 0x04, 0x22, 0x68, 0x11, 0x04, 0x33, 0x33, 0x34, 0x33, 0x9E, 0x16}
	// data := []byte{0xFE, 0xFE, 0xFE, 0xFE, 0x68, 0x72, 0x32, 0x09, 0x19, 0x04, 0x22, 0x68, 0x91, 0x08, 0x33, 0x33, 0x34, 0x33, 0x33, 0x33, 0x33, 0x33, 0xEE, 0x16, 0x32, 0xE2, 0x20}
	// data := []byte{0xFE, 0xFE, 0xFE, 0xFE, 0x68, 0x72, 0x32, 0x09, 0x19, 0x04, 0x22, 0x68, 0x91, 0x08, 0x33, 0x33, 0x34, 0x33, 0x33, 0x33, 0x33, 0x33, 0xEE, 0x16}
	out, err := Parse(data)
	require.NoError(t, err)
	t.Logf("%#v", out)
	var r *DataResult
	r, err = out.Data.ParseValue()
	require.NoError(t, err)
	t.Logf("%#v", r)
}

func TestNew(t *testing.T) {
	raw := []byte{0xFE, 0xFE, 0xFE, 0xFE, 0x68, 0x72, 0x32, 0x09, 0x19, 0x04, 0x22, 0x68, 0x11, 0x04, 0x33, 0x33, 0x34, 0x33, 0x9E, 0x16}
	out, err := Parse(raw)
	require.NoError(t, err)
	t.Logf("%#v", out)

	cmd := New("220419093272", IForwardPowerTotal, nil)
	t.Logf("%#v", raw)
	t.Logf("%#v", cmd.Bytes())
	require.Equal(t, raw, cmd.Bytes())
}

func TestERR(t *testing.T) {
	n := 0x35
	t.Logf("%08b", n)
}

func TestVoltage(t *testing.T) {
	raw := []byte{0xFE, 0xFE, 0xFE, 0xFE, 0x68, 0x34, 0x18, 0x04, 0x24, 0x06, 0x24, 0x68, 0x91, 0x0A, 0x33, 0x32, 0x34, 0x35, 0x45, 0x56, 0x33, 0x33, 0x33, 0x33, 0x3E, 0x16}
	out, err := Parse(raw)
	require.NoError(t, err)
	t.Logf("%#v", out)

	var r *DataResult
	r, err = out.Data.ParseValue()
	require.NoError(t, err)
	t.Logf("%#v", r)
}
